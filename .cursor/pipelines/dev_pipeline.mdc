---
description: 
globs: 
alwaysApply: false
---
{
  "context": "hierarchical_development_pipeline",
  "description": "Интеллектуальный пайплайн, управляющий полным циклом разработки с улучшенной отказоустойчивостью и директивным исполнением.",
  "entry_point": "Инициализация и декомпозиция",
  "pipeline": [
    {
      "name": "Инициализация и декомпозиция",
      "description": "Начальный шаг. Определяет, является ли текущая задача родительской, и запускает соответствующий воркфлоу.",
      "task": "Проанализировать номер задачи {task_id}. Если номер имеет формат X.Y, это родительская задача. Если X.Y.Z, это подзадача.",
      "next": {
        "conditions": [
          {
            "condition": "Задача является родительской",
            "next_step": "Оркестрация выполнения подзадач"
          }
        ],
        "default": "Анализ и Планирование"
      }
    },
    {
      "name": "Оркестрация выполнения подзадач",
      "description": "Управляет жизненным циклом родительской задачи. Выполняет ее подзадачи последовательно.",
      "task": [
        "Обновить статус родительской задачи {task_id} на 'В работе'.",
        "Найти все файлы подзадач для родительской задачи {task_id}, которые имеют статус 'Ожидание'.",
        "Собрать список всех выполненных задач (прочитав их статусы).",
        "Для каждой невыполненной подзадачи прочитать её поле 'dependencies'.",
        "Выбрать для выполнения ту подзадачу, у которой все зависимости из списка уже находятся в статусе 'Выполнена' (или у которой зависимостей нет).",
        "Если найдена готовая к выполнению подзадача, запустить для нее соответствующий воркфлоу.",
        "Если готовых к выполнению подзадач нет, но остались незавершенные, ожидать их выполнения.",
        "Если все подзадачи выполнены, перейти к шагу 'Завершение родительской задачи'."
      ]
    },
    {
      "name": "Анализ и Планирование",
      "description": "Генерация детального плана выполнения подзадачи в структурированном формате.",
      "task": [
        "Твоя роль: 'Robotic Senior System Architect AI'.",
        "Используй содержимое файла подзадачи {task_id} и project_docs\SAD.md. Используй рекомендации сервиса "Context7" который подключен к текущей Cursor IDE по MCP.",
        "Сгенерируй детальный план выполнения в формате Markdown по шаблону, приведенному ниже. Твой вывод должен содержать только этот Markdown-документ."
      ],
      "next": "Разработка"
    },
    {
      "name": "Разработка",
      "description": "Генерация изменений в коде в формате git diff на основе плана.",
      "task": [
        "Твоя роль: 'Robotic Senior Software Engineer AI'.",
        "Твоя задача — преобразовать 'Пошаговый план действий' из ранее созданного Markdown-плана в код.",
        "Твой вывод должен быть представлен ИСКЛЮЧИТЕЛЬНО в формате 'git diff' (unified format).",
        "Не включай в вывод никаких пояснений или комментариев вне формата diff."
      ],
      "next": "Тестирование"
    },
    {
      "name": "Тестирование",
      "description": "Запуск автотестов для проверки реализованной функциональности.",
      "task": "Примени сгенерированный 'git diff' к временной копии кодовой базы. Проведи тестирование в соответствии с правилами из .cursor/rules/testing.mdc.",
      "next": {
        "on_success": "Ревью кода",
        "on_failure": "Багфиксинг"
      }
    },
    {
      "name": "Багфиксинг",
      "description": "Цикл исправления ошибок, выявленных на этапе тестирования или ревью.",
      "task": [
        "Твоя роль: 'Robotic Senior Debugging Analyst AI'.",
        "Проанализируй логи проваленных тестов и ранее созданный план.",
        "Строго следуй двухэтапному процессу из .cursor/rules/bugfixing.mdc: сначала сгенерируй отчет об анализе бага, затем — git diff с исправлением."
      ],
      "next": "Тестирование"
    },
    {
      "name": "Ревью кода",
      "description": "Проведение само-ревью выполненной работы по чек-листу.",
      "task": "Проведи ревью сгенерированного 'git diff' и плана по подзадаче в соответствии с правилами из .cursor/rules/review.mdc. Определи результат: 'Успех' (все корректно), 'Неудача' (требуется мелкий багфиксинг) или 'Катастрофическая неудача' (ошибка в архитектуре или плане).",
      "next": {
        "on_success": "Завершение подзадачи",
        "on_failure": "Багфиксинг",
        "on_catastrophic_failure": "Эскалация и Перепланирование"
      }
    },
    {
      "name": "Эскалация и Перепланирование",
      "description": "Обработка фундаментальных ошибок, требующих пересмотра плана или архитектуры.",
      "task": [
        "Пометь текущую подзадачу {task_id} статусом 'Заблокирована (Архитектура)'.",
        "Сгенерируй отчет для техлида в формате Markdown, который включает:",
        "1. Ссылку на проблемную подзадачу.",
        "2. Описание обнаруженной фундаментальной ошибки (например, 'Выбранный архитектурный паттерн не подходит для решения этой задачи, потому что...').",
        "3. Рекомендацию по дальнейшим действиям (например, 'Требуется пересмотр секции X в ai_executable_plan.json и перезапуск связанных задач').",
        "Останови выполнение текущего пайплайна для этой подзадачи."
      ]
    },
    {
      "name": "Завершение подзадачи",
      "description": "Финализация работы по конкретной единице работы.",
      "task": [
        "Примени финальный 'git diff' к основной кодовой базе.",
        "Сделай атомарный commit в git с детальным сообщением согласно правилам.",
        "Обнови статус подзадачи на 'Выполнена' в ее файле.",
        "Собери план и финальный diff в краткий отчет о проделанной работе и принятых решениях по этой подзадаче.",
        "Сигнализировать 'Оркестратору' о завершении."
      ]
    },
    {
      "name": "Завершение родительской задачи",
      "description": "Финализация работы по родительской задаче.",
      "task": [
        "Обнови статус родительской задачи на 'Ожидание подтверждения'.",
        "Скомпилируй все планы и отчеты по подзадачам в один общий, структурированный финальный отчет.",
        "Напиши или обнови общую документацию (tech_docs.mdc, user_docs.mdc).",
        "Обнови README.md, если применимо.",
        "Представь финальный отчет пользователю и запроси формальное подтверждение."
      ]
    }
  ]
} 